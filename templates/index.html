<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZHAKE BRAINROT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: 'Arial Black', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #000; color: #fff; overflow: hidden; font-weight: 900; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('/static/bg.jpg') center/cover no-repeat; opacity: 0.7; z-index: -1; }
        .main-card { background: rgba(0, 0, 0, 0.75); padding: 35px; border-radius: 35px; width: 90%; max-width: 450px; border: 3px solid #FFDE00; text-align: center; backdrop-filter: blur(15px); }
        .btn { background: rgba(15,15,15,0.9); color: #fff; border: 3px solid #FFDE00; padding: 18px; border-radius: 12px; width: 100%; margin-bottom: 15px; font-weight: 900; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; text-transform: uppercase; font-size: 18px; }
        .btn:hover { background: #FFDE00; color: #000; }
        #subB { background: #FFDE00; color: #000; border: none; }
        .label { color: #FFDE00; font-size: 13px; text-align: left; display: block; margin: 15px 0 5px 10px; text-transform: uppercase; }
        .input-group { display: flex; align-items: center; background: rgba(0,0,0,0.8); border: 2px solid #FFDE00; border-radius: 12px; margin-bottom: 15px; padding: 5px 15px; }
        .input-group input { background: transparent; border: none; color: #fff; padding: 10px; width: 100%; outline: none; font-size: 18px; font-weight: 900; }
        .screen { display: none; }
        .active { display: block; }
        .timer-box { font-size: 60px; color: #FFDE00; margin: 10px 0; }
        .timer-desc { font-size: 14px; color: #ccc; margin-bottom: 20px; line-height: 1.4; }
        .back-link { color: #FFDE00; cursor: pointer; text-decoration: underline; margin-top: 10px; display: inline-block; }
    </style>
</head>
<body onload="checkStatus()">
<div class="bg-overlay"></div>
<div class="main-card">
    <div id="s1" class="screen active">
        <h2>–í–´–ë–ï–†–ò–¢–ï –Ø–ó–´–ö</h2>
        <button class="btn" onclick="setL('ru')">–†–£–°–°–ö–ò–ô</button>
        <button class="btn" onclick="setL('kz')">–ö–ê–ó–ê–ö–®–ê</button>
    </div>
    <div id="s2" class="screen">
        <h2 id="mTitle">ZHAKE BRAINROT</h2>
        <button class="btn" id="sellBtn" onclick="openSell()">üêØ –ü–†–û–î–ê–¢–¨ –ë–†–ï–ô–ù–†–û–¢</button>
        <button class="btn" onclick="window.open('https://t.me/zhakebreinrot')">–ù–ê–® –ö–ê–ù–ê–õ üöÄ</button>
    </div>
    <div id="s3" class="screen">
        <h2 id="formTitle">–ü–†–û–î–ê–ñ–ê</h2>
        <form id="ankForm">
            <input type="hidden" name="sid" id="userSid">
            <span class="label" id="lab1">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –≤ —Å–µ–∫ (1-9999):</span>
            <div class="input-group">ü™ê <input type="number" name="profit" min="1" max="9999" required></div>
            <span class="label" id="lab2">–¶–µ–Ω–∞ (–¢–µ–Ω–≥–µ):</span>
            <div class="input-group">üí∞ <input type="number" name="price" required></div>
            <span class="label" id="lab3">WhatsApp:</span>
            <div class="input-group">üì± <input type="text" name="phone" placeholder="7707..." required></div>
            <span class="label" id="lab4">–§–æ—Ç–æ (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</span>
            <div class="input-group">üñºÔ∏è <input type="file" name="photo" accept="image/*" required style="font-size: 12px; color:#888;"></div>
            <button type="button" class="btn" id="subB" onclick="submitAnketa()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
        </form>
        <div class="back-link" onclick="go('s2')">–ù–∞–∑–∞–¥</div>
    </div>
    <div id="sWait" class="screen">
        <h2 id="wT">–ü–û–î–û–ñ–î–ò–¢–ï</h2>
        <p class="timer-desc" id="tDesc">–í–∞—à–∞ –∞–Ω–∫–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –≤ —Å–∫–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –∫–∞–Ω–∞–ª–µ.</p>
        <div class="timer-box" id="timer">05:00</div>
        <div class="back-link" onclick="go('s2')">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</div>
    </div>
</div>

<script>
    let L = 'ru';
    const socket = io();
    socket.on('connect', () => { document.getElementById('userSid').value = socket.id; });

    socket.on('anketa_accepted', (data) => {
        alert(data.msg);
        if(confirm("–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–π –ª–æ—Ç –≤ –∫–∞–Ω–∞–ª–µ?")) { window.open(data.link); }
    });

    function go(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    
    async function checkStatus(){
        const res = await fetch('/check_timer');
        const data = await res.json();
        if(data.status === 'wait') { startTimer(data.remaining); }
    }

    function openSell() {
        fetch('/check_timer').then(r => r.json()).then(data => {
            if(data.status === 'wait') { go('sWait'); } else { go('s3'); }
        });
    }

    function setL(lang){
        L = lang;
        if(lang==='kz'){
            document.getElementById('mTitle').innerText='–ñ–ê–ö–ï –ë–†–ï–ô–ù–†–û–¢';
            document.getElementById('sellBtn').innerText='üêØ –ë–†–ï–ô–ù–†–û–¢ –°–ê–¢–£';
            document.getElementById('wT').innerText='–ö–£–¢–ò–ù–´–ó';
            document.getElementById('tDesc').innerText='–°–∏–∑–¥–∏–Ω –∞–Ω–∫–µ—Ç–∞–Ω—ã–∑ —Ç–µ–∫—Å–µ—Ä—É–¥–µ, —Ç–µ–∑ –∞—Ä–∞–¥–∞ –∫–∞–Ω–∞–ª–¥–∞ –ø–∞–π–¥–∞ –±–æ–ª–∞–¥—ã.';
        } else {
            document.getElementById('wT').innerText='–ü–û–î–û–ñ–î–ò–¢–ï';
            document.getElementById('tDesc').innerText='–í–∞—à–∞ –∞–Ω–∫–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –≤ —Å–∫–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –∫–∞–Ω–∞–ª–µ.';
        }
        go('s2');
    }

    async function submitAnketa(){
        const form = document.getElementById('ankForm');
        if(!form.checkValidity()) { alert(L==='ru'?'–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ!':'–ë–∞—Ä–ª—ã–∫ –∂–µ—Ä–¥–∏ —Ç–æ–ª—Ç—ã—Ä—ã–ø, —Ñ–æ—Ç–æ —Ç–∞–Ω–¥–∞–Ω—ã–∑!'); return; }
        
        const b = document.getElementById('subB');
        const fd = new FormData(form);
        b.disabled = true;

        const res = await fetch('/send_anketa', { method: 'POST', body: fd });
        if (res.ok) { startTimer(300); go('sWait'); }
        else { const data = await res.json(); if(data.status === 'wait') { startTimer(data.remaining); go('sWait'); } }
        b.disabled = false;
    }

    function startTimer(sec) {
        const display = document.getElementById('timer');
        let t = sec;
        const interval = setInterval(() => {
            let m = Math.floor(t / 60); let s = t % 60;
            display.innerText = `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
            if (--t < 0) { clearInterval(interval); location.reload(); }
        }, 1000);
    }
</script>
</body>
</html>